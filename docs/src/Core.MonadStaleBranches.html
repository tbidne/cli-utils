<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE InstanceSigs #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Module      : Core.MonadStaleBranches</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- License     : BSD3</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Maintainer  : tbidne@gmail.com</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- The MonadStaleBranches class.</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Core.MonadStaleBranches</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Core.MonadStaleBranches.html#MonadStaleBranches"><span class="hs-identifier">MonadStaleBranches</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Core.MonadStaleBranches.html#runGitUtils"><span class="hs-identifier">runGitUtils</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="App.html"><span class="hs-identifier">App</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.ParallelIO.Global</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Par</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Core.IO.html"><span class="hs-identifier">Core.IO</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Core.Internal.html"><span class="hs-identifier">Core.Internal</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">K</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Types.Branch.html"><span class="hs-identifier">Types.Branch</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Types.Env.html"><span class="hs-identifier">Types.Env</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Types.Error.html"><span class="hs-identifier">Types.Error</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Types.Filtered.html"><span class="hs-identifier">Types.Filtered</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Types.GitTypes.html"><span class="hs-identifier">Types.GitTypes</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Types.ResultsWithErrs.html"><span class="hs-identifier">Types.ResultsWithErrs</span></a></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-comment">-- | The 'MonadStaleBranches' class is used to describe interacting with a</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- git filesystem.</span><span>
</span><span id="line-34"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadStaleBranches"><span class="annot"><a href="Core.MonadStaleBranches.html#MonadStaleBranches"><span class="hs-identifier hs-var">MonadStaleBranches</span></a></span></span><span> </span><span id="local-6989586621679070331"><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-comment">-- | Adds custom handling to returned data (e.g. for error handling).</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Handler"><span class="annot"><a href="Core.MonadStaleBranches.html#Handler"><span class="hs-identifier hs-var">Handler</span></a></span></span><span> </span><span id="local-6989586621679070331"><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679070292"><span class="annot"><a href="#local-6989586621679070292"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">K.Type</span></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-comment">-- | The type returned by `collectResults`.</span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="FinalResults"><span class="annot"><a href="Core.MonadStaleBranches.html#FinalResults"><span class="hs-identifier hs-var">FinalResults</span></a></span></span><span> </span><span id="local-6989586621679070331"><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">K.Type</span></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-comment">-- | Returns a [`Name`] representing git branches.</span><span>
</span><span id="line-42"></span><span>  </span><span id="branchNamesByGrep"><span class="annot"><a href="Core.MonadStaleBranches.html#branchNamesByGrep"><span class="hs-identifier hs-type">branchNamesByGrep</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Core.MonadStaleBranches.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Types.GitTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-comment">-- | Maps [`Name`] to [`NameAuthDay`], filtering out non-stale branches.</span><span>
</span><span id="line-45"></span><span>  </span><span id="getStaleLogs"><span class="annot"><a href="Core.MonadStaleBranches.html#getStaleLogs"><span class="hs-identifier hs-type">getStaleLogs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Core.MonadStaleBranches.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Types.GitTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.Filtered.html#Filtered"><span class="hs-identifier hs-type">Filtered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Core.MonadStaleBranches.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Types.GitTypes.html#NameAuthDay"><span class="hs-identifier hs-type">NameAuthDay</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-comment">-- | Maps [`NameAuthDay`] to [`AnyBranch`].</span><span>
</span><span id="line-48"></span><span>  </span><span id="toBranches"><span class="annot"><a href="Core.MonadStaleBranches.html#toBranches"><span class="hs-identifier hs-type">toBranches</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.Filtered.html#Filtered"><span class="hs-identifier hs-type">Filtered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Core.MonadStaleBranches.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Types.GitTypes.html#NameAuthDay"><span class="hs-identifier hs-type">NameAuthDay</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Core.MonadStaleBranches.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Types.Branch.html#AnyBranch"><span class="hs-identifier hs-type">AnyBranch</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-comment">-- | Collects [`AnyBranch`] into `FinalResults`.</span><span>
</span><span id="line-51"></span><span>  </span><span id="collectResults"><span class="annot"><a href="Core.MonadStaleBranches.html#collectResults"><span class="hs-identifier hs-type">collectResults</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Core.MonadStaleBranches.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Types.Branch.html#AnyBranch"><span class="hs-identifier hs-type">AnyBranch</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Core.MonadStaleBranches.html#FinalResults"><span class="hs-identifier hs-type">FinalResults</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-comment">-- | Displays results.</span><span>
</span><span id="line-54"></span><span>  </span><span id="display"><span class="annot"><a href="Core.MonadStaleBranches.html#display"><span class="hs-identifier hs-type">display</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Core.MonadStaleBranches.html#FinalResults"><span class="hs-identifier hs-type">FinalResults</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679070331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">-- | `MonadStaleBranches` instance for (`AppT` m) over `R.MonadIO`. This means we can</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- encounter exceptions, but</span><span>
</span><span id="line-58"></span><span class="hs-comment">--</span><span>
</span><span id="line-59"></span><span class="hs-comment">--   * We do not want a single exception trying to parse one branch kill</span><span>
</span><span id="line-60"></span><span class="hs-comment">--     the entire program.</span><span>
</span><span id="line-61"></span><span class="hs-comment">--   * We do not want to ignore problems entirely.</span><span>
</span><span id="line-62"></span><span class="hs-comment">--</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- We opt to define `Handler` as (`ErrOr` a), which is an alias for (`Either` `Err` a).</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- We collect the results in `ResultsWithErrs`, which contains a list of errors</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- and two maps, one for merged branches and another for unmerged branches.</span><span>
</span><span id="line-66"></span><span id="local-6989586621679070286"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679070286"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Core.MonadStaleBranches.html#MonadStaleBranches"><span class="hs-identifier hs-type">MonadStaleBranches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="App.html#AppT"><span class="hs-identifier hs-type">AppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070286"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Handler"><span class="annot"><a href="Core.MonadStaleBranches.html#Handler"><span class="hs-identifier hs-var">Handler</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="App.html#AppT"><span class="hs-identifier hs-type">AppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070286"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679070278"><span class="annot"><a href="#local-6989586621679070278"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Types.Error.html#ErrOr"><span class="hs-identifier hs-type">ErrOr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070278"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="FinalResults"><span class="annot"><a href="Core.MonadStaleBranches.html#FinalResults"><span class="hs-identifier hs-var">FinalResults</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="App.html#AppT"><span class="hs-identifier hs-type">AppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070286"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Types.ResultsWithErrs.html#ResultsWithErrs"><span class="hs-identifier hs-type">ResultsWithErrs</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Core.MonadStaleBranches.html#branchNamesByGrep"><span class="hs-identifier hs-type">branchNamesByGrep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="App.html#AppT"><span class="hs-identifier hs-type">AppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070286"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.Error.html#ErrOr"><span class="hs-identifier hs-type">ErrOr</span></a></span><span> </span><span class="annot"><a href="Types.GitTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-72"></span><span>  </span><span id="local-6989586621679070277"><span class="annot"><span class="annottext">branchNamesByGrep :: AppT m [ErrOr Name]
</span><a href="#local-6989586621679070277"><span class="hs-identifier hs-var hs-var hs-var hs-var">branchNamesByGrep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-73"></span><span>    </span><span id="local-6989586621679070276"><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679070276"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; Maybe FilePath) -&gt; AppT m (Maybe FilePath)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">R.asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Maybe FilePath
</span><a href="Types.Env.html#path"><span class="hs-identifier hs-var hs-var">path</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621679070273"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679070273"><span class="hs-identifier hs-var">searchStr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; Maybe Text) -&gt; AppT m (Maybe Text)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">R.asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Maybe Text
</span><a href="Types.Env.html#grepStr"><span class="hs-identifier hs-var hs-var">grepStr</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span id="local-6989586621679070271"><span class="annot"><span class="annottext">BranchType
</span><a href="#local-6989586621679070271"><span class="hs-identifier hs-var">bType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; BranchType) -&gt; AppT m BranchType
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">R.asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; BranchType
</span><a href="Types.Env.html#branchType"><span class="hs-identifier hs-var hs-var">branchType</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679070269"><span class="annot"><span class="annottext">branchFn :: Text -&gt; Bool
</span><a href="#local-6989586621679070269"><span class="hs-identifier hs-var hs-var">branchFn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679070273"><span class="hs-identifier hs-var">searchStr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-77"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Text -&gt; Bool) -&gt; Text -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="Core.Internal.html#badBranch"><span class="hs-identifier hs-var">badBranch</span></a></span><span>
</span><span id="line-78"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679070265"><span class="annot"><span class="annottext">s :: Text
</span><a href="#local-6989586621679070265"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-79"></span><span>            </span><span class="hs-glyph">\</span><span id="local-6989586621679070264"><span class="annot"><span class="annottext">t :: Text
</span><a href="#local-6989586621679070264"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Text -&gt; Bool) -&gt; Text -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="Core.Internal.html#badBranch"><span class="hs-identifier hs-var">badBranch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679070264"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.toCaseFold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679070265"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`T.isInfixOf`</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.toCaseFold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679070264"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-80"></span><span>        </span><span id="local-6989586621679070260"><span class="annot"><span class="annottext">toNames' :: Text -&gt; [ErrOr Name]
</span><a href="#local-6989586621679070260"><span class="hs-identifier hs-var hs-var">toNames'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ErrOr Name) -&gt; [Text] -&gt; [ErrOr Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ErrOr Name
</span><a href="Core.Internal.html#textToName"><span class="hs-identifier hs-var">textToName</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [ErrOr Name])
-&gt; (Text -&gt; [Text]) -&gt; Text -&gt; [ErrOr Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; [Text] -&gt; [Text]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621679070269"><span class="hs-identifier hs-var">branchFn</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [Text]) -&gt; (Text -&gt; [Text]) -&gt; Text -&gt; [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.lines</span></span><span>
</span><span id="line-81"></span><span>        </span><span id="local-6989586621679070257"><span class="annot"><span class="annottext">cmd :: Text
</span><a href="#local-6989586621679070257"><span class="hs-identifier hs-var hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;git branch &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BranchType -&gt; FilePath
</span><a href="Types.Env.html#branchTypeToArg"><span class="hs-identifier hs-var">branchTypeToArg</span></a></span><span> </span><span class="annot"><span class="annottext">BranchType
</span><a href="#local-6989586621679070271"><span class="hs-identifier hs-var">bType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span id="local-6989586621679070254"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679070254"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Text -&gt; AppT m Text
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">R.liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Text -&gt; AppT m Text) -&gt; IO Text -&gt; AppT m Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe FilePath -&gt; IO Text
</span><a href="Core.IO.html#sh"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679070257"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679070276"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><span class="annottext">IO [ErrOr Name] -&gt; AppT m [ErrOr Name]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">R.liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [ErrOr Name] -&gt; AppT m [ErrOr Name])
-&gt; IO [ErrOr Name] -&gt; AppT m [ErrOr Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO [ErrOr Name] -&gt; IO [ErrOr Name]
forall a. IO a -&gt; IO a
</span><a href="Core.IO.html#logIfErr"><span class="hs-identifier hs-var">logIfErr</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [ErrOr Name] -&gt; IO [ErrOr Name])
-&gt; IO [ErrOr Name] -&gt; IO [ErrOr Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ErrOr Name] -&gt; IO [ErrOr Name]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([ErrOr Name] -&gt; IO [ErrOr Name])
-&gt; [ErrOr Name] -&gt; IO [ErrOr Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [ErrOr Name]
</span><a href="#local-6989586621679070260"><span class="hs-identifier hs-var">toNames'</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679070254"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><a href="Core.MonadStaleBranches.html#getStaleLogs"><span class="hs-identifier hs-type">getStaleLogs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.Error.html#ErrOr"><span class="hs-identifier hs-type">ErrOr</span></a></span><span> </span><span class="annot"><a href="Types.GitTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="App.html#AppT"><span class="hs-identifier hs-type">AppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070286"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.Filtered.html#Filtered"><span class="hs-identifier hs-type">Filtered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.Error.html#ErrOr"><span class="hs-identifier hs-type">ErrOr</span></a></span><span> </span><span class="annot"><a href="Types.GitTypes.html#NameAuthDay"><span class="hs-identifier hs-type">NameAuthDay</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>  </span><span id="local-6989586621679070250"><span class="annot"><span class="annottext">getStaleLogs :: [ErrOr Name] -&gt; AppT m (Filtered (ErrOr NameAuthDay))
</span><a href="#local-6989586621679070250"><span class="hs-identifier hs-var hs-var hs-var hs-var">getStaleLogs</span></a></span></span><span> </span><span id="local-6989586621679070249"><span class="annot"><span class="annottext">ns :: [ErrOr Name]
</span><a href="#local-6989586621679070249"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-87"></span><span>    </span><span id="local-6989586621679070248"><span class="annot"><span class="annottext">Day
</span><a href="#local-6989586621679070248"><span class="hs-identifier hs-var">day</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; Day) -&gt; AppT m Day
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">R.asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Day
</span><a href="Types.Env.html#today"><span class="hs-identifier hs-var hs-var">today</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span id="local-6989586621679070246"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621679070246"><span class="hs-identifier hs-var">lim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; Nat) -&gt; AppT m Nat
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">R.asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Nat
</span><a href="Types.Env.html#limit"><span class="hs-identifier hs-var hs-var">limit</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621679070244"><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679070244"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; Maybe FilePath) -&gt; AppT m (Maybe FilePath)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">R.asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Maybe FilePath
</span><a href="Types.Env.html#path"><span class="hs-identifier hs-var hs-var">path</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679070243"><span class="annot"><span class="annottext">staleFilter' :: [ErrOr NameAuthDay] -&gt; Filtered (ErrOr NameAuthDay)
</span><a href="#local-6989586621679070243"><span class="hs-identifier hs-var hs-var">staleFilter'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ErrOr NameAuthDay -&gt; Bool)
-&gt; [ErrOr NameAuthDay] -&gt; Filtered (ErrOr NameAuthDay)
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Filtered a
</span><a href="Types.Filtered.html#mkFiltered"><span class="hs-identifier hs-var">mkFiltered</span></a></span><span> </span><span class="annot"><span class="annottext">((ErrOr NameAuthDay -&gt; Bool)
 -&gt; [ErrOr NameAuthDay] -&gt; Filtered (ErrOr NameAuthDay))
-&gt; (ErrOr NameAuthDay -&gt; Bool)
-&gt; [ErrOr NameAuthDay]
-&gt; Filtered (ErrOr NameAuthDay)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Day -&gt; ErrOr NameAuthDay -&gt; Bool
</span><a href="Core.Internal.html#staleNonErr"><span class="hs-identifier hs-var">staleNonErr</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621679070246"><span class="hs-identifier hs-var">lim</span></a></span><span> </span><span class="annot"><span class="annottext">Day
</span><a href="#local-6989586621679070248"><span class="hs-identifier hs-var">day</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span id="local-6989586621679070240"><span class="annot"><span class="annottext">[Either SomeException (ErrOr NameAuthDay)]
</span><a href="#local-6989586621679070240"><span class="hs-identifier hs-var">logs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Either SomeException (ErrOr NameAuthDay)]
-&gt; AppT m [Either SomeException (ErrOr NameAuthDay)]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">R.liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [Either SomeException (ErrOr NameAuthDay)]
 -&gt; AppT m [Either SomeException (ErrOr NameAuthDay)])
-&gt; IO [Either SomeException (ErrOr NameAuthDay)]
-&gt; AppT m [Either SomeException (ErrOr NameAuthDay)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[IO (ErrOr NameAuthDay)]
-&gt; IO [Either SomeException (ErrOr NameAuthDay)]
forall a. [IO a] -&gt; IO [Either SomeException a]
</span><span class="hs-identifier hs-var">Par.parallelE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ErrOr Name -&gt; IO (ErrOr NameAuthDay))
-&gt; [ErrOr Name] -&gt; [IO (ErrOr NameAuthDay)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe FilePath -&gt; ErrOr Name -&gt; IO (ErrOr NameAuthDay)
</span><a href="Core.IO.html#nameToLog"><span class="hs-identifier hs-var">nameToLog</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679070244"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ErrOr Name]
</span><a href="#local-6989586621679070249"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="annottext">IO (Filtered (ErrOr NameAuthDay))
-&gt; AppT m (Filtered (ErrOr NameAuthDay))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">R.liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Filtered (ErrOr NameAuthDay))
 -&gt; AppT m (Filtered (ErrOr NameAuthDay)))
-&gt; IO (Filtered (ErrOr NameAuthDay))
-&gt; AppT m (Filtered (ErrOr NameAuthDay))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Filtered (ErrOr NameAuthDay) -&gt; IO (Filtered (ErrOr NameAuthDay))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Filtered (ErrOr NameAuthDay) -&gt; IO (Filtered (ErrOr NameAuthDay)))
-&gt; Filtered (ErrOr NameAuthDay)
-&gt; IO (Filtered (ErrOr NameAuthDay))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ErrOr NameAuthDay] -&gt; Filtered (ErrOr NameAuthDay)
</span><a href="#local-6989586621679070243"><span class="hs-identifier hs-var">staleFilter'</span></a></span><span> </span><span class="annot"><span class="annottext">([ErrOr NameAuthDay] -&gt; Filtered (ErrOr NameAuthDay))
-&gt; ([Either SomeException (ErrOr NameAuthDay)]
    -&gt; [ErrOr NameAuthDay])
-&gt; [Either SomeException (ErrOr NameAuthDay)]
-&gt; Filtered (ErrOr NameAuthDay)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Either SomeException (ErrOr NameAuthDay) -&gt; ErrOr NameAuthDay)
-&gt; [Either SomeException (ErrOr NameAuthDay)]
-&gt; [ErrOr NameAuthDay]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Either SomeException (ErrOr NameAuthDay) -&gt; ErrOr NameAuthDay
forall a b. Show a =&gt; Either a (Either Err b) -&gt; Either Err b
</span><a href="Core.Internal.html#exceptToErr"><span class="hs-identifier hs-var">exceptToErr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Either SomeException (ErrOr NameAuthDay)]
</span><a href="#local-6989586621679070240"><span class="hs-identifier hs-var">logs</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><a href="Core.MonadStaleBranches.html#toBranches"><span class="hs-identifier hs-type">toBranches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.Filtered.html#Filtered"><span class="hs-identifier hs-type">Filtered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.Error.html#ErrOr"><span class="hs-identifier hs-type">ErrOr</span></a></span><span> </span><span class="annot"><a href="Types.GitTypes.html#NameAuthDay"><span class="hs-identifier hs-type">NameAuthDay</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="App.html#AppT"><span class="hs-identifier hs-type">AppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070286"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.Error.html#ErrOr"><span class="hs-identifier hs-type">ErrOr</span></a></span><span> </span><span class="annot"><a href="Types.Branch.html#AnyBranch"><span class="hs-identifier hs-type">AnyBranch</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-94"></span><span>  </span><span id="local-6989586621679070236"><span class="annot"><span class="annottext">toBranches :: Filtered (ErrOr NameAuthDay) -&gt; AppT m [ErrOr AnyBranch]
</span><a href="#local-6989586621679070236"><span class="hs-identifier hs-var hs-var hs-var hs-var">toBranches</span></a></span></span><span> </span><span id="local-6989586621679070235"><span class="annot"><span class="annottext">ns :: Filtered (ErrOr NameAuthDay)
</span><a href="#local-6989586621679070235"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-95"></span><span>    </span><span id="local-6989586621679070234"><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679070234"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; Maybe FilePath) -&gt; AppT m (Maybe FilePath)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">R.asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Maybe FilePath
</span><a href="Types.Env.html#path"><span class="hs-identifier hs-var hs-var">path</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span id="local-6989586621679070233"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679070233"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; Text) -&gt; AppT m Text
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">R.asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Text
</span><a href="Types.Env.html#master"><span class="hs-identifier hs-var hs-var">master</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621679070231"><span class="annot"><span class="annottext">[Either SomeException (ErrOr AnyBranch)]
</span><a href="#local-6989586621679070231"><span class="hs-identifier hs-var">branches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Either SomeException (ErrOr AnyBranch)]
-&gt; AppT m [Either SomeException (ErrOr AnyBranch)]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">R.liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [Either SomeException (ErrOr AnyBranch)]
 -&gt; AppT m [Either SomeException (ErrOr AnyBranch)])
-&gt; IO [Either SomeException (ErrOr AnyBranch)]
-&gt; AppT m [Either SomeException (ErrOr AnyBranch)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[IO (ErrOr AnyBranch)]
-&gt; IO [Either SomeException (ErrOr AnyBranch)]
forall a. [IO a] -&gt; IO [Either SomeException a]
</span><span class="hs-identifier hs-var">Par.parallelE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ErrOr NameAuthDay -&gt; IO (ErrOr AnyBranch))
-&gt; [ErrOr NameAuthDay] -&gt; [IO (ErrOr AnyBranch)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe FilePath -&gt; Text -&gt; ErrOr NameAuthDay -&gt; IO (ErrOr AnyBranch)
</span><a href="Core.IO.html#errTupleToBranch"><span class="hs-identifier hs-var">errTupleToBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679070234"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679070233"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Filtered (ErrOr NameAuthDay) -&gt; [ErrOr NameAuthDay]
forall a. Filtered a -&gt; [a]
</span><a href="Types.Filtered.html#unFiltered"><span class="hs-identifier hs-var hs-var">unFiltered</span></a></span><span> </span><span class="annot"><span class="annottext">Filtered (ErrOr NameAuthDay)
</span><a href="#local-6989586621679070235"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><span class="annottext">IO [ErrOr AnyBranch] -&gt; AppT m [ErrOr AnyBranch]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">R.liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [ErrOr AnyBranch] -&gt; AppT m [ErrOr AnyBranch])
-&gt; IO [ErrOr AnyBranch] -&gt; AppT m [ErrOr AnyBranch]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ErrOr AnyBranch] -&gt; IO [ErrOr AnyBranch]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([ErrOr AnyBranch] -&gt; IO [ErrOr AnyBranch])
-&gt; [ErrOr AnyBranch] -&gt; IO [ErrOr AnyBranch]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Either SomeException (ErrOr AnyBranch) -&gt; ErrOr AnyBranch)
-&gt; [Either SomeException (ErrOr AnyBranch)] -&gt; [ErrOr AnyBranch]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Either SomeException (ErrOr AnyBranch) -&gt; ErrOr AnyBranch
forall a b. Show a =&gt; Either a (Either Err b) -&gt; Either Err b
</span><a href="Core.Internal.html#exceptToErr"><span class="hs-identifier hs-var">exceptToErr</span></a></span><span> </span><span class="annot"><span class="annottext">[Either SomeException (ErrOr AnyBranch)]
</span><a href="#local-6989586621679070231"><span class="hs-identifier hs-var">branches</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="Core.MonadStaleBranches.html#collectResults"><span class="hs-identifier hs-type">collectResults</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.Error.html#ErrOr"><span class="hs-identifier hs-type">ErrOr</span></a></span><span> </span><span class="annot"><a href="Types.Branch.html#AnyBranch"><span class="hs-identifier hs-type">AnyBranch</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="App.html#AppT"><span class="hs-identifier hs-type">AppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070286"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Types.ResultsWithErrs.html#ResultsWithErrs"><span class="hs-identifier hs-type">ResultsWithErrs</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621679070228"><span class="annot"><span class="annottext">collectResults :: [ErrOr AnyBranch] -&gt; AppT m ResultsWithErrs
</span><a href="#local-6989586621679070228"><span class="hs-identifier hs-var hs-var hs-var hs-var">collectResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResultsWithErrs -&gt; AppT m ResultsWithErrs
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ResultsWithErrs -&gt; AppT m ResultsWithErrs)
-&gt; ([ErrOr AnyBranch] -&gt; ResultsWithErrs)
-&gt; [ErrOr AnyBranch]
-&gt; AppT m ResultsWithErrs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ErrOr AnyBranch] -&gt; ResultsWithErrs
</span><a href="Types.ResultsWithErrs.html#toResultsWithErrs"><span class="hs-identifier hs-var">toResultsWithErrs</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="Core.MonadStaleBranches.html#display"><span class="hs-identifier hs-type">display</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.ResultsWithErrs.html#ResultsWithErrs"><span class="hs-identifier hs-type">ResultsWithErrs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="App.html#AppT"><span class="hs-identifier hs-type">AppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070286"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>  </span><span id="local-6989586621679070226"><span class="annot"><span class="annottext">display :: ResultsWithErrs -&gt; AppT m ()
</span><a href="#local-6989586621679070226"><span class="hs-identifier hs-var hs-var hs-var hs-var">display</span></a></span></span><span> </span><span id="local-6989586621679070225"><span class="annot"><span class="annottext">res :: ResultsWithErrs
</span><a href="#local-6989586621679070225"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621679070224"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679070224"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; Text) -&gt; AppT m Text
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">R.asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Text
</span><a href="Types.Env.html#remoteName"><span class="hs-identifier hs-var hs-var">remoteName</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; AppT m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">R.liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; AppT m ()) -&gt; IO () -&gt; AppT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; FilePath) -&gt; Text -&gt; FilePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ResultsWithErrs -&gt; Text
</span><a href="Types.ResultsWithErrs.html#displayResultsWithErrs"><span class="hs-identifier hs-var">displayResultsWithErrs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679070224"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ResultsWithErrs
</span><a href="#local-6989586621679070225"><span class="hs-identifier hs-var">res</span></a></span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- | High level logic of `MonadStaleBranches` usage. This function is the</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- entrypoint for any `MonadStaleBranches` instance.</span><span>
</span><span id="line-110"></span><span id="local-6989586621679070219"><span class="annot"><a href="Core.MonadStaleBranches.html#runGitUtils"><span class="hs-identifier hs-type">runGitUtils</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Core.MonadStaleBranches.html#MonadStaleBranches"><span class="hs-identifier hs-type">MonadStaleBranches</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679070219"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679070219"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-111"></span><span id="runGitUtils"><span class="annot"><span class="annottext">runGitUtils :: m ()
</span><a href="Core.MonadStaleBranches.html#runGitUtils"><span class="hs-identifier hs-var hs-var">runGitUtils</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>  </span><span id="local-6989586621679070218"><span class="annot"><span class="annottext">[Handler m Name]
</span><a href="#local-6989586621679070218"><span class="hs-identifier hs-var">branchNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [Handler m Name]
forall (m :: * -&gt; *). MonadStaleBranches m =&gt; m [Handler m Name]
</span><a href="Core.MonadStaleBranches.html#branchNamesByGrep"><span class="hs-identifier hs-var">branchNamesByGrep</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span id="local-6989586621679070217"><span class="annot"><span class="annottext">Filtered (Handler m NameAuthDay)
</span><a href="#local-6989586621679070217"><span class="hs-identifier hs-var">staleLogs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Handler m Name] -&gt; m (Filtered (Handler m NameAuthDay))
forall (m :: * -&gt; *).
MonadStaleBranches m =&gt;
[Handler m Name] -&gt; m (Filtered (Handler m NameAuthDay))
</span><a href="Core.MonadStaleBranches.html#getStaleLogs"><span class="hs-identifier hs-var">getStaleLogs</span></a></span><span> </span><span class="annot"><span class="annottext">[Handler m Name]
</span><a href="#local-6989586621679070218"><span class="hs-identifier hs-var">branchNames</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span id="local-6989586621679070216"><span class="annot"><span class="annottext">[Handler m AnyBranch]
</span><a href="#local-6989586621679070216"><span class="hs-identifier hs-var">staleBranches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Filtered (Handler m NameAuthDay) -&gt; m [Handler m AnyBranch]
forall (m :: * -&gt; *).
MonadStaleBranches m =&gt;
Filtered (Handler m NameAuthDay) -&gt; m [Handler m AnyBranch]
</span><a href="Core.MonadStaleBranches.html#toBranches"><span class="hs-identifier hs-var">toBranches</span></a></span><span> </span><span class="annot"><span class="annottext">Filtered (Handler m NameAuthDay)
</span><a href="#local-6989586621679070217"><span class="hs-identifier hs-var">staleLogs</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span id="local-6989586621679070215"><span class="annot"><span class="annottext">FinalResults m
</span><a href="#local-6989586621679070215"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Handler m AnyBranch] -&gt; m (FinalResults m)
forall (m :: * -&gt; *).
MonadStaleBranches m =&gt;
[Handler m AnyBranch] -&gt; m (FinalResults m)
</span><a href="Core.MonadStaleBranches.html#collectResults"><span class="hs-identifier hs-var">collectResults</span></a></span><span> </span><span class="annot"><span class="annottext">[Handler m AnyBranch]
</span><a href="#local-6989586621679070216"><span class="hs-identifier hs-var">staleBranches</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><span class="annottext">FinalResults m -&gt; m ()
forall (m :: * -&gt; *).
MonadStaleBranches m =&gt;
FinalResults m -&gt; m ()
</span><a href="Core.MonadStaleBranches.html#display"><span class="hs-identifier hs-var">display</span></a></span><span> </span><span class="annot"><span class="annottext">FinalResults m
</span><a href="#local-6989586621679070215"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-117"></span></pre></body></html>